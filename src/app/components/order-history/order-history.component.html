<div class="card">
    <div class="flex justify-between items-center mb-4">
        <div class="font-semibold text-xl">{{ 'OrderHistory.Title' | translate }}</div>
        <button
            class="btn btn-outline-primary"
            (click)="refreshOrders()"
            [disabled]="isLoading$ | async"
            style="
                padding: 0.5rem 1rem;
                border: 1px solid #007bff;
                background: transparent;
                color: #007bff;
                border-radius: 4px;
                cursor: pointer;
            "
        >
            <i class="pi pi-refresh" [class.pi-spin]="isLoading$ | async"></i>
            <span class="ml-2">{{
                (isLoading$ | async) ? ('Common.Loading' | translate) : ('OrderHistory.Refresh' | translate)
            }}</span>
        </button>
    </div>

    <!-- Loading State -->
    @if (isLoading$ | async) {
        <div class="text-center py-4">
            <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
            <p class="mt-2">{{ 'OrderHistory.LoadingOrders' | translate }}</p>
        </div>
    }

    <!-- Error State -->
    @if (!(isLoading$ | async) && (errorMessage$ | async)) {
        <div>
            <p-message severity="error" [closable]="false">
                <span>{{ errorMessage$ | async }}</span>
            </p-message>
        </div>
    }

    <!-- Orders Table -->
    @if (!(isLoading$ | async) && !(errorMessage$ | async) && (orderHistoryList$ | async)?.length! > 0) {
        <div>
            <p-table
                [value]="(orderHistoryList$ | async) || []"
                [scrollable]="true"
                scrollHeight="680px"
                [tableStyle]="{ 'min-width': '60rem' }"
            >
                <ng-template pTemplate="header">
                    <tr>
                        <th style="width: 25%">{{ 'OrderHistory.TrackingNumber' | translate }}</th>
                        <th style="width: 25%">{{ 'OrderHistory.Total' | translate }}</th>
                        <th style="width: 25%">{{ 'Cart.TotalQuantity' | translate }}</th>
                        <th style="width: 25%">{{ 'OrderHistory.Date' | translate }}</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-order>
                    <tr>
                        <td>{{ order.orderTrackingNumber }}</td>
                        <td>{{ order.totalPrice | currency: 'USD' }}</td>
                        <td>{{ order.totalQuantity }}</td>
                        <td>{{ order.dateCreated | date: 'medium' }}</td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    }

    <!-- No Orders Found -->
    @if (!(isLoading$ | async) && !(errorMessage$ | async) && (orderHistoryList$ | async)?.length === 0) {
        <div>
            <p-message severity="info" [closable]="false">
                <span>{{ 'OrderHistory.NoOrdersMessage' | translate }}</span>
            </p-message>
        </div>
    }
</div>
